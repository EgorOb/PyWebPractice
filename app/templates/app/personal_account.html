<!DOCTYPE html>
{% load static %}
{% load crispy_forms_tags %}
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Личный кабинет автора</title>
<link rel="stylesheet" href="{% static 'app/personal.css' %}">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script src="{% static 'tinymce/tinymce.min.js' %}"></script>
<script>
tinymce.init({
  selector: '#id_content',
  height: 500, // Высота текстовой области в пикселях
  language: "ru",
});
</script>
</head>
<body>

<div class="author-dashboard">
  <div class="navigation-panel">
    <div class="dashboard-section nav-list">
    <h3>Навигация</h3>
      <ul>
        <li><a href="/">На главную</a></li>
        <li>2</li>
        <li>3</li>
      </ul>
  </div>
  </div>

  <div class="main-content">
    <div class="dashboard-section create-post">
        <button id="create-post-button" type="button">
            <i class="fa fa-plus"></i>Создать пост
        </button>
      <form id="create-post-form" action="." method="post" enctype="multipart/form-data" class="p-3" style="display: none">
        <!-- Форма для создания нового поста -->
        {% csrf_token %}
        <div class="form-group">
            {{ entry_form.blog|as_crispy_field }}
        </div>
        <div class="form-group">
            {{ entry_form.headline|as_crispy_field }}
        </div>
{#        <div class="form-group">#}
{#            {{ entry_form.slug_headline|as_crispy_field }}#}
{#        </div>#}
        <div class="form-group">
            {{ entry_form.summary|as_crispy_field }}
        </div>
          <div class="form-group">
{#            {{ entry_form.body_text|as_crispy_field }}#}
            <textarea id="id_content" name="body_text" placeholder="Содержимое поста"></textarea>
        </div>
          <div class="form-group">
            {{ entry_form.pub_date|as_crispy_field }}
        </div>
          <input type="text" id="authorSearch" placeholder="Поиск автора">
          <div class="form-group">
            {{ entry_form.authors|as_crispy_field }}
        </div>
          <div class="form-group">
            {{ entry_form.image|as_crispy_field }}
        </div>
          <div class="form-group">
            {{ entry_form.tags|as_crispy_field }}
        </div>
        <div>
            <ul>
                <span class='button-group'>
                    <button type="submit">
                        <i class="fa fa-blog"></i>Опубликовать
                    </button>
                </span>
                <span class='button-group'>
                    <button type="submit" class="delay">
                        <i class="fa fa-clock"></i>Отложить публикацию
                    </button></span>
                <span class='button-group'>
                    <button type="submit" class="draft">
                        <i class="fa fa-pen-ruler"></i>Сохранить как черновик
                    </button>
                </span>
            </ul>
        </div>
      </form>
    </div>
  </div>

  <div class="sidebar">
    <div class="dashboard-section articles-list">
      <h3>Мои статьи</h3>
      <ul>
          {% for entry in entries %}
        <li><a href="{% url 'app:post-detail' entry.slug_headline %}">{{ entry.headline }}</a></li>
          {% endfor %}
      </ul>
    </div>

    <div class="dashboard-section comments-list">
      <h3>Новые комментарии на статьях</h3>
      <ul>
        {% for comment in comments %}
        <li><a href="{% url 'app:post-detail' comment.entry.slug_headline %}#comment-id-{{ comment.id }}">{{ comment.text }}</a></li>
          {% endfor %}
      </ul>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const createPostButton = document.getElementById("create-post-button");
  const createPostForm = document.getElementById("create-post-form");

  createPostButton.addEventListener("click", function() {
    if (createPostForm.style.display === "none" || createPostForm.style.display === "") {
      createPostForm.style.display = "block";
    } else {
      createPostForm.style.display = "none";
    }
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Получаем элементы
    var authorSelect = document.getElementById("id_authors");
    var authorSearchInput = document.getElementById("authorSearch");

    // Копируем все опции для последующей фильтрации
    var allOptions = Array.from(authorSelect.options);

    // Сохраняем исходные выбранные опции
    var selectedOptions = Array.from(authorSelect.selectedOptions);

    // Обработчик события ввода в поле поиска
    authorSearchInput.addEventListener("input", function() {
        var searchTerm = authorSearchInput.value.toLowerCase();

        // Фильтруем опции в соответствии с введенным текстом
        var filteredOptions = allOptions.filter(function(option) {
            return option.text.toLowerCase().includes(searchTerm);
        });

        // Очищаем список
        authorSelect.innerHTML = '';

        // Добавляем отфильтрованные опции обратно в список
        filteredOptions.forEach(function(option) {
            authorSelect.appendChild(option.cloneNode(true));
        });

        // Восстанавливаем ранее выбранные опции
        selectedOptions.forEach(function(selectedOption) {
            var restoredOption = authorSelect.querySelector('option[value="' + selectedOption.value + '"]');
            if (restoredOption) {
                restoredOption.selected = true;
            }
        });
    });
});
</script>


</body>
</html>